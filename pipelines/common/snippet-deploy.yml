parameters:
  azureSub: ''
  webAppRG: ''
  webApp: ''
  slot: 'production'

steps:
- task: AzureResourceGroupDeployment@2
  displayName: 'Azure Deployment:Create Azure App Service'
  inputs:
    azureSubscription: ${{ parameters.azureSub }}
    ResourceGroupName: ${{ parameters.webAppRG }}
    location: 'Canada Central'
    csmFile: '$(Pipeline.Workspace)/**/linux-webapp-template.json'
    overrideParameters: '-webAppName ${{ parameters.webApp }} -hostingPlanName automagically-demo1-app-plan -appInsightsLocation "Canada Central" -sku "S1 Standard"'

- task: AzureRmWebAppDeployment@4
  displayName: 'Deploy Azure App Service: ${{ parameters.webApp }}'
  inputs:
    azureSubscription: ${{ parameters.azureSub }}
    ResourceGroupName: ${{ parameters.webAppRG }}
    WebAppName: ${{ parameters.webApp }}
    appType: 'webAppLinux'
    RuntimeStack: 'dotnetcore|2.2'
    StartupCommand: 'dotnet aspnet-core-dotnet-core.dll'
    packageForLinux: '$(Pipeline.Workspace)/**/*.zip'
    deployToSlotOrASE: ${{ ne(parameters.slot, 'production') }}
    SlotName: ${{ parameters.slot }}
    enableCustomDeployment: true
    ExcludeFilesFromAppDataFlag: false
